class e{static name="Lodash";static version="1.2.2";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static get(e={},t="",s=void 0){Array.isArray(t)||(t=this.toPath(t));const r=t.reduce(((e,t)=>Object(e)[t]),e);return void 0===r?s:r}static set(e={},t="",s){return Array.isArray(t)||(t=this.toPath(t)),t.slice(0,-1).reduce(((e,s,r)=>Object(e[s])===e[s]?e[s]:e[s]=/^\d+$/.test(t[r+1])?[]:{}),e)[t[t.length-1]]=s,e}static unset(e={},t=""){return Array.isArray(t)||(t=this.toPath(t)),t.reduce(((e,s,r)=>r===t.length-1?(delete e[s],!0):Object(e)[s]),e)}static toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static unescape(e){const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,(e=>t[e]))}}class t{static name="$Storage";static version="1.0.9";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static data=null;static dataFile="box.dat";static#e=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static#t(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}static getItem(t=new String,s=null){let r=s;if(!0===t.startsWith("@")){const{key:s,path:o}=t.match(this.#e)?.groups;t=s;let n=this.getItem(t,{});"object"!=typeof n&&(n={}),r=e.get(n,o);try{r=JSON.parse(r)}catch(e){}}else{switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.read(t);break;case"Quantumult X":r=$prefs.valueForKey(t);break;case"Node.js":this.data=this.#s(this.dataFile),r=this.data?.[t];break;default:r=this.data?.[t]||null}try{r=JSON.parse(r)}catch(e){}}return r??s}static setItem(t=new String,s=new String){let r=!1;if("object"==typeof s)s=JSON.stringify(s);else s=String(s);if(!0===t.startsWith("@")){const{key:o,path:n}=t.match(this.#e)?.groups;t=o;let a=this.getItem(t,{});"object"!=typeof a&&(a={}),e.set(a,n,s),r=this.setItem(t,a)}else switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":r=$persistentStore.write(s,t);break;case"Quantumult X":r=$prefs.setValueForKey(s,t);break;case"Node.js":this.data=this.#s(this.dataFile),this.data[t]=s,this.#r(this.dataFile),r=!0;break;default:r=this.data?.[t]||null}return r}static removeItem(t){let s=!1;if(!0===t.startsWith("@")){const{key:r,path:o}=t.match(this.#e)?.groups;t=r;let n=this.getItem(t);"object"!=typeof n&&(n={}),keyValue=e.unset(n,o),s=this.setItem(t,n)}else switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:s=!1;break;case"Quantumult X":s=$prefs.removeValueForKey(t)}return s}static clear(){let e=!1;switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:e=!1;break;case"Quantumult X":e=$prefs.removeAllValues()}return e}static#s(e){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),r=this.fs.existsSync(t),o=!r&&this.fs.existsSync(s);if(!r&&!o)return{};{const e=r?t:s;try{return JSON.parse(this.fs.readFileSync(e))}catch(e){return{}}}}}static#r(e=this.dataFile){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),r=this.fs.existsSync(t),o=!r&&this.fs.existsSync(s),n=JSON.stringify(this.data);r?this.fs.writeFileSync(t,n):o?this.fs.writeFileSync(s,n):this.fs.writeFileSync(t,n)}}}class s{static name="ENV";static version="1.8.3";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}constructor(e,t){console.log(`\n🟧 ${s.name} v${s.version}\n`),this.name=e,this.logs=[],this.isMute=!1,this.isMuteLog=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log(`\n🚩 开始!\n${e}\n`)}environment(){switch(this.platform()){case"Surge":return $environment.app="Surge",$environment;case"Stash":return $environment.app="Stash",$environment;case"Egern":return $environment.app="Egern",$environment;case"Loon":let e=$loon.split(" ");return{device:e[0],ios:e[1],"loon-version":e[2],app:"Loon"};case"Quantumult X":return{app:"Quantumult X"};case"Node.js":return process.env.app="Node.js",process.env;default:return{}}}platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}isNode(){return"Node.js"===this.platform()}isQuanX(){return"Quantumult X"===this.platform()}isSurge(){return"Surge"===this.platform()}isLoon(){return"Loon"===this.platform()}isShadowrocket(){return"Shadowrocket"===this.platform()}isStash(){return"Stash"===this.platform()}isEgern(){return"Egern"===this.platform()}async getScript(e){return await this.fetch(e).then((e=>e.body))}async runScript(e,s){let r=t.getItem("@chavy_boxjs_userCfgs.httpapi");r=r?.replace?.(/\n/g,"")?.trim();let o=t.getItem("@chavy_boxjs_userCfgs.httpapi_timeout");o=1*o??20,o=s?.timeout??o;const[n,a]=r.split("@"),i={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:o},headers:{"X-Key":n,Accept:"*/*"},timeout:o};await this.fetch(i).then((e=>e.body),(e=>this.logErr(e)))}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar))}async fetch(t={}||"",s={}){switch(t.constructor){case Object:t={...s,...t};break;case String:t={...s,url:t}}t.method||(t.method="GET",(t.body??t.bodyBytes)&&(t.method="POST")),delete t.headers?.Host,delete t.headers?.[":authority"],delete t.headers?.["Content-Length"],delete t.headers?.["content-length"];const r=t.method.toLocaleLowerCase();switch(this.platform()){case"Loon":case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return t.timeout&&(t.timeout=parseInt(t.timeout,10),this.isSurge()||(t.timeout=1e3*t.timeout)),t.policy&&(this.isLoon()&&(t.node=t.policy),this.isStash()&&e.set(t,"headers.X-Stash-Selected-Proxy",encodeURI(t.policy)),this.isShadowrocket()&&e.set(t,"headers.X-Surge-Proxy",t.policy)),"boolean"==typeof t.redirection&&(t["auto-redirect"]=t.redirection),t.bodyBytes&&!t.body&&(t.body=t.bodyBytes,delete t.bodyBytes),await new Promise(((e,s)=>{$httpClient[r](t,((r,o,n)=>{r?s(r):(o.ok=/^2\d\d$/.test(o.status),o.statusCode=o.status,n&&(o.body=n,1==t["binary-mode"]&&(o.bodyBytes=n)),e(o))}))}));case"Quantumult X":return t.policy&&e.set(t,"opts.policy",t.policy),"boolean"==typeof t["auto-redirect"]&&e.set(t,"opts.redirection",t["auto-redirect"]),t.body instanceof ArrayBuffer?(t.bodyBytes=t.body,delete t.body):ArrayBuffer.isView(t.body)?(t.bodyBytes=t.body.buffer.slice(t.body.byteOffset,t.body.byteLength+t.body.byteOffset),delete object.body):t.body&&delete t.bodyBytes,await $task.fetch(t).then((e=>(e.ok=/^2\d\d$/.test(e.statusCode),e.status=e.statusCode,e)),(e=>Promise.reject(e.error)));case"Node.js":let s=require("iconv-lite");this.initGotEnv(t);const{url:o,...n}=t;return await this.got[r](o,n).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>(e.statusCode=e.status,e.body=s.decode(e.rawBody,this.encoding),e.bodyBytes=e.rawBody,e)),(e=>Promise.reject(e.message)))}}time(e,t=null){const s=t?new Date(t):new Date;let r={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in r)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[t]:("00"+r[t]).substr((""+r[t]).length)));return e}msg(e=name,t="",s="",r){const o=e=>{switch(typeof e){case void 0:return e;case"string":switch(this.platform()){case"Surge":case"Stash":case"Egern":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.platform()){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return{url:e.url||e.openUrl||e["open-url"]};case"Loon":return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]};case"Quantumult X":return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl,"update-pasteboard":e["update-pasteboard"]||e.updatePasteboard};case"Node.js":return}default:return}};if(!this.isMute)switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":default:$notification.post(e,t,s,o(r));break;case"Quantumult X":$notify(e,t,s,o(r));case"Node.js":}if(!this.isMuteLog){let r=["","==============📣系统通知📣=============="];r.push(e),t&&r.push(t),s&&r.push(s),console.log(r.join("\n")),this.logs=this.logs.concat(r)}}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️ ${this.name}, 错误!`,e);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,e.stack)}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(t={}){const s=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🚩 ${this.name}, 结束! 🕛 ${s} 秒`,""),this.platform()){case"Surge":t.policy&&e.set(t,"headers.X-Surge-Policy",t.policy),$done(t);break;case"Loon":t.policy&&(t.node=t.policy),$done(t);break;case"Stash":t.policy&&e.set(t,"headers.X-Stash-Selected-Proxy",encodeURI(t.policy)),$done(t);break;case"Egern":case"Shadowrocket":default:$done(t);break;case"Quantumult X":t.policy&&e.set(t,"opts.policy",t.policy),delete t["auto-redirect"],delete t["auto-cookie"],delete t["binary-mode"],delete t.charset,delete t.host,delete t.insecure,delete t.method,delete t.opt,delete t.path,delete t.policy,delete t["policy-descriptor"],delete t.scheme,delete t.sessionIndex,delete t.statusCode,delete t.timeout,t.body instanceof ArrayBuffer?(t.bodyBytes=t.body,delete t.body):ArrayBuffer.isView(t.body)?(t.bodyBytes=t.body.buffer.slice(t.body.byteOffset,t.body.byteLength+t.body.byteOffset),delete t.body):t.body&&delete t.bodyBytes,$done(t);break;case"Node.js":process.exit(1)}}}var r={Switch:!0},o={Settings:r},n={Switch:!0,Detail:{splash:!0,feed:!0,activity:!1,story:!0,cinema:!0,view:!0,search:!0,xlive:!0,Hot_search:!0,Hot_topics:!0,Most_visited:!0,Dynamic_adcard:!0}},a={Settings:n},i=Database={Default:Object.freeze({__proto__:null,Settings:r,default:o}),ADBlock:Object.freeze({__proto__:null,Settings:n,default:a})};function c(s,r,o){console.log("☑️ Set Environment Variables","");let{Settings:n,Caches:a,Configs:i}=function(s,r,o){let n=t.getItem(s,o),a={};if("undefined"!=typeof $argument&&Boolean($argument)){let t=Object.fromEntries($argument.split("&").map((e=>e.split("=").map((e=>e.replace(/\"/g,""))))));for(let s in t)e.set(a,s,t[s])}const i={Settings:o?.Default?.Settings||{},Configs:o?.Default?.Configs||{},Caches:{}};Array.isArray(r)||(r=[r]);for(let e of r)i.Settings={...i.Settings,...o?.[e]?.Settings,...a,...n?.[e]?.Settings},i.Configs={...i.Configs,...o?.[e]?.Configs},n?.[e]?.Caches&&"string"==typeof n?.[e]?.Caches&&(n[e].Caches=JSON.parse(n?.[e]?.Caches)),i.Caches={...i.Caches,...n?.[e]?.Caches};return function e(t,s){for(var r in t){var o=t[r];t[r]="object"==typeof o&&null!==o?e(o,s):s(r,o)}return t}(i.Settings,((e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map((e=>c(e))):c(t)),t))),i;function c(e){return e&&!isNaN(e)&&(e=parseInt(e,10)),e}}(s,r,o);return Array.isArray(n?.Locales)||(n.Locales=n.Locales?[n.Locales]:[]),console.log(`✅ Set Environment Variables, Settings: ${typeof n}, Settings内容: ${JSON.stringify(n)}`,""),{Settings:n,Caches:a,Configs:i}}var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u={exports:{}};var d,f,p={exports:{}};function g(){return d||(d=1,p.exports=(e=e||function(e,t){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==l&&l.crypto&&(s=l.crypto),!s)try{s=require("crypto")}catch(e){}var r=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),n={},a=n.lib={},i=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=i.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,s=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var n=0;n<o;n++){var a=s[n>>>2]>>>24-n%4*8&255;t[r+n>>>2]|=a<<24-(r+n)%4*8}else for(var i=0;i<o;i+=4)t[r+i>>>2]=s[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(r());return new c.init(t,e)}}),h=n.enc={},u=h.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],o=0;o<s;o++){var n=t[o>>>2]>>>24-o%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,s=[],r=0;r<t;r+=2)s[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(s,t/2)}},d=h.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],o=0;o<s;o++){var n=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var t=e.length,s=[],r=0;r<t;r++)s[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(s,t)}},f=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,r=this._data,o=r.words,n=r.sigBytes,a=this.blockSize,i=n/(4*a),l=(i=t?e.ceil(i):e.max((0|i)-this._minBufferSize,0))*a,h=e.min(4*l,n);if(l){for(var u=0;u<l;u+=a)this._doProcessBlock(o,u);s=o.splice(0,l),r.sigBytes-=h}return new c.init(s,h)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new g.HMAC.init(e,s).finalize(t)}}});var g=n.algo={};return n}(Math),e)),p.exports;var e}u.exports=(f=g(),function(e){var t=f,s=t.lib,r=s.WordArray,o=s.Hasher,n=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var i=n.MD5=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var r=t+s,o=e[r];e[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var n=this._hash.words,i=e[t+0],d=e[t+1],f=e[t+2],p=e[t+3],g=e[t+4],y=e[t+5],m=e[t+6],b=e[t+7],S=e[t+8],w=e[t+9],v=e[t+10],$=e[t+11],k=e[t+12],_=e[t+13],B=e[t+14],x=e[t+15],C=n[0],j=n[1],E=n[2],O=n[3];C=c(C,j,E,O,i,7,a[0]),O=c(O,C,j,E,d,12,a[1]),E=c(E,O,C,j,f,17,a[2]),j=c(j,E,O,C,p,22,a[3]),C=c(C,j,E,O,g,7,a[4]),O=c(O,C,j,E,y,12,a[5]),E=c(E,O,C,j,m,17,a[6]),j=c(j,E,O,C,b,22,a[7]),C=c(C,j,E,O,S,7,a[8]),O=c(O,C,j,E,w,12,a[9]),E=c(E,O,C,j,v,17,a[10]),j=c(j,E,O,C,$,22,a[11]),C=c(C,j,E,O,k,7,a[12]),O=c(O,C,j,E,_,12,a[13]),E=c(E,O,C,j,B,17,a[14]),C=l(C,j=c(j,E,O,C,x,22,a[15]),E,O,d,5,a[16]),O=l(O,C,j,E,m,9,a[17]),E=l(E,O,C,j,$,14,a[18]),j=l(j,E,O,C,i,20,a[19]),C=l(C,j,E,O,y,5,a[20]),O=l(O,C,j,E,v,9,a[21]),E=l(E,O,C,j,x,14,a[22]),j=l(j,E,O,C,g,20,a[23]),C=l(C,j,E,O,w,5,a[24]),O=l(O,C,j,E,B,9,a[25]),E=l(E,O,C,j,p,14,a[26]),j=l(j,E,O,C,S,20,a[27]),C=l(C,j,E,O,_,5,a[28]),O=l(O,C,j,E,f,9,a[29]),E=l(E,O,C,j,b,14,a[30]),C=h(C,j=l(j,E,O,C,k,20,a[31]),E,O,y,4,a[32]),O=h(O,C,j,E,S,11,a[33]),E=h(E,O,C,j,$,16,a[34]),j=h(j,E,O,C,B,23,a[35]),C=h(C,j,E,O,d,4,a[36]),O=h(O,C,j,E,g,11,a[37]),E=h(E,O,C,j,b,16,a[38]),j=h(j,E,O,C,v,23,a[39]),C=h(C,j,E,O,_,4,a[40]),O=h(O,C,j,E,i,11,a[41]),E=h(E,O,C,j,p,16,a[42]),j=h(j,E,O,C,m,23,a[43]),C=h(C,j,E,O,w,4,a[44]),O=h(O,C,j,E,k,11,a[45]),E=h(E,O,C,j,x,16,a[46]),C=u(C,j=h(j,E,O,C,f,23,a[47]),E,O,i,6,a[48]),O=u(O,C,j,E,b,10,a[49]),E=u(E,O,C,j,B,15,a[50]),j=u(j,E,O,C,y,21,a[51]),C=u(C,j,E,O,k,6,a[52]),O=u(O,C,j,E,p,10,a[53]),E=u(E,O,C,j,v,15,a[54]),j=u(j,E,O,C,d,21,a[55]),C=u(C,j,E,O,S,6,a[56]),O=u(O,C,j,E,x,10,a[57]),E=u(E,O,C,j,m,15,a[58]),j=u(j,E,O,C,_,21,a[59]),C=u(C,j,E,O,g,6,a[60]),O=u(O,C,j,E,$,10,a[61]),E=u(E,O,C,j,f,15,a[62]),j=u(j,E,O,C,w,21,a[63]),n[0]=n[0]+C|0,n[1]=n[1]+j|0,n[2]=n[2]+E|0,n[3]=n[3]+O|0},_doFinalize:function(){var t=this._data,s=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;s[o>>>5]|=128<<24-o%32;var n=e.floor(r/4294967296),a=r;s[15+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),s[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(s.length+1),this._process();for(var i=this._hash,c=i.words,l=0;l<4;l++){var h=c[l];c[l]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return i},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,s,r,o,n,a){var i=e+(t&s|~t&r)+o+a;return(i<<n|i>>>32-n)+t}function l(e,t,s,r,o,n,a){var i=e+(t&r|s&~r)+o+a;return(i<<n|i>>>32-n)+t}function h(e,t,s,r,o,n,a){var i=e+(t^s^r)+o+a;return(i<<n|i>>>32-n)+t}function u(e,t,s,r,o,n,a){var i=e+(s^(t|~r))+o+a;return(i<<n|i>>>32-n)+t}t.MD5=o._createHelper(i),t.HmacMD5=o._createHmacHelper(i)}(Math),f.MD5);var y=h(u.exports);const m=new s("📺 BiliBili: 🛡️ ADBlock v0.3.1(1005) request");let b;const S=new URL($request.url);m.log(`⚠ url: ${S.toJSON()}`,"");const w=$request.method,v=S.hostname,$=S.pathname;S.pathname.split("/").filter(Boolean),m.log(`⚠ METHOD: ${w}, HOST: ${v}, PATH: ${$}`,"");const k=($request.headers?.["Content-Type"]??$request.headers?.["content-type"])?.split(";")?.[0];m.log(`⚠ FORMAT: ${k}`,""),(async()=>{const{Settings:e,Caches:t,Configs:s}=c("BiliBili","ADBlock",i);switch(m.log(`⚠ Settings.Switch: ${e?.Switch}`,""),e.Switch){case!0:default:switch(w){case"POST":case"PUT":case"PATCH":case"DELETE":case"GET":case"HEAD":case"OPTIONS":default:switch(v){case"www.bilibili.com":case"search.bilibili.com":break;case"app.bilibili.com":case"app.biliapi.net":switch($){case"/x/v2/splash/show":case"/x/v2/splash/list":case"/x/v2/splash/brand/list":case"/x/v2/splash/event/list2":break;case"/x/v2/feed/index":switch(e?.Detail?.feed){case!0:default:switch(e?.Detail?.activity){case!0:default:if(S.searchParams.has("banner_hash")&&"0"!==S.searchParams.get("login_event")){S.searchParams.delete("sign"),S.searchParams.set("open_event",""),S.searchParams.set("pull",0),t.banner_hash&&(S.searchParams.set("banner_hash",t.banner_hash),m.log("🎉 读取hash缓存成功"));const e=S.search.substring(1)+"c2ed53a74eeefe3cf99fbd01d8c9c375",s=y(e).toString();S.searchParams.set("sign",s)}break;case!1:m.log("🚧 用户设置推荐页活动大图不去除")}break;case!1:m.log("🚧 用户设置推荐页广告不去除")}}}case"CONNECT":case"TRACE":}$request.url=S.toString(),m.log("🚧 调试信息",`$request.url: ${$request.url}`,"");case!1:}})().catch((e=>m.logErr(e))).finally((()=>{if(void 0===b)m.done($request);else m.isQuanX()?(b.status||(b.status="HTTP/1.1 200 OK"),delete b.headers?.["Content-Length"],delete b.headers?.["content-length"],delete b.headers?.["Transfer-Encoding"],m.done(b)):m.done({response:b})}));
